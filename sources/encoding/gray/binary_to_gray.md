# Binary to Gray Encoder

|         |                                                                                  |
| ------- | -------------------------------------------------------------------------------- |
| Module  | Binary to Gray Encoder                                                           |
| Project | [OmniCores-BuildingBlocks](https://github.com/Louis-DR/OmniCores-BuildingBlocks) |
| Author  | Louis Duret-Robert - [louisduret@gmail.com](mailto:louisduret@gmail.com)         |
| Website | [louis-dr.github.io](https://louis-dr.github.io)                                 |
| License | MIT License - [mit-license.org](https://mit-license.org)                         |

## Overview

![binary_to_gray](binary_to_gray.symbol.svg)

Converts binary numbers to Gray code (also known as reflected binary code). Gray code is a binary numeral system where two successive values differ in only one bit. This property makes Gray code particularly useful in applications where minimizing switching transitions is important, such as rotary encoders, analog-to-digital converters, and Karnaugh maps. The module supports any even range, including ranges that are not a power-of-two.

## Parameters

| Name    | Type    | Allowed Values | Default         | Description                                                                  |
| ------- | ------- | -------------- | --------------- | ---------------------------------------------------------------------------- |
| `RANGE` | integer | `≥2` and even  | `16`            | The number of unique values in the code. Must be an even number.             |
| `WIDTH` | integer | `≥1`           | `$clog2(RANGE)` | Bit width of the binary/gray vectors. Automatically calculated from `RANGE`. |

## Ports

| Name     | Direction | Width   | Clock | Reset | Reset value | Description                 |
| -------- | --------- | ------- | ----- | ----- | ----------- | --------------------------- |
| `binary` | input     | `WIDTH` |       |       |             | Binary input to be encoded. |
| `gray`   | output    | `WIDTH` |       |       |             | Gray code output.           |

## Operation

The binary-to-gray conversion follows a simple algorithm where each bit of the Gray code is generated by XORing adjacent bits of the binary input. The most significant bit (MSB) of the Gray code is the same as the MSB of the binary input. For all other positions `i`, the Gray code bit is computed as `gray[i] = binary[i+1] ^ binary[i]`.

This ensures that consecutive binary numbers produce Gray codes that differ by exactly one bit, which is the fundamental property of Gray code sequences.

For non-power-of-two even ranges, a static offset is applied to the binary input before the conversion to prune the ends of the Gray sequence of the next higher power-of-two range while maintaining the Gray code properties.

## Paths

| From     | To     | Type          | Comment                            |
| -------- | ------ | ------------- | ---------------------------------- |
| `binary` | `gray` | combinational | Direct XOR-based conversion logic. |

## Complexity

| Delay  | Gates      | Comment                                   |
| ------ | ---------- | ----------------------------------------- |
| `O(1)` | `O(WIDTH)` | Single level of XOR gates for conversion. |

The conversion requires `WIDTH-1` XOR gates and has a constant propagation delay independent of the bit width, making it highly efficient for real-time applications.

## Verification

The binary-to-gray encoder is verified using a comprehensive SystemVerilog testbench that validates both the conversion correctness and the fundamental Gray code properties. The testbench instanciates and verifies both the `binary_to_gray` and `gray_to_binary` modules.

The following table lists the checks performed by the testbench.

| Number | Check           | Description                                                                              |
| ------ | --------------- | ---------------------------------------------------------------------------------------- |
| 1a     | Exhaustive test | If `RANGE ≤ 1024`, checks the Gray code and its properties for all binary input values . |
| 1b     | Random test     | If `RANGE > 1024`, checks the Gray code and its properties for random sequences.         |

The following table lists the parameter values verified by the testbench.

| `RANGE` |           |
| ------- | --------- |
| 16      | (default) |

## Constraints

There are no synthesis and implementation constraints for this block.

## Deliverables

| Type              | File                                                           | Description                                         |
| ----------------- | -------------------------------------------------------------- | --------------------------------------------------- |
| Design            | [`binary_to_gray.v`](binary_to_gray.v)                         | Verilog design.                                     |
| Testbench         | [`gray.testbench.sv`](gray.testbench.sv)                       | SystemVerilog verification shared testbench.        |
| Waveform script   | [`gray.testbench.gtkw`](gray.testbench.gtkw)                   | Script to load the waveforms in GTKWave.            |
| Symbol descriptor | [`binary_to_gray.symbol.sss`](binary_to_gray.symbol.sss)       | Symbol descriptor for SiliconSuite-SymbolGenerator. |
| Symbol image      | [`binary_to_gray.symbol.svg`](binary_to_gray.symbol.svg)       | Generated vector image of the symbol.               |
| Symbol shape      | [`binary_to_gray.symbol.drawio`](binary_to_gray.symbol.drawio) | Generated DrawIO shape of the symbol.               |
| Datasheet         | [`binary_to_gray.md`](binary_to_gray.md)                       | Markdown documentation datasheet.                   |

## Dependencies

This module has no external module dependencies.

## Related modules

| Module                                              | Path                                               | Comment                    |
| --------------------------------------------------- | -------------------------------------------------- | -------------------------- |
| [`gray_to_binary`](gray_to_binary.md)               | `omnicores-buildingblocks/sources/encoding/gray`   | Gray to binary decoder.    |
| [`binary_to_onehot`](../onehot/binary_to_onehot.md) | `omnicores-buildingblocks/sources/encoding/onehot` | Binary to one-hot encoder. |
| [`binary_to_bcd`](binary_to_bcd.md)                 | `omnicores-buildingblocks/sources/encoding/bcd`    | Binary to BCD encoder.     |

## References

- [Wikipedia, “Gray code”.](https://en.wikipedia.org/wiki/Gray_code)
- [Max Maxfield, “How to generate Gray Codes for non-power-of-2 sequences”, EETimes.com, 29/06/2007.](https://www.eetimes.com/how-to-generate-gray-codes-for-non-power-of-2-sequences/)
