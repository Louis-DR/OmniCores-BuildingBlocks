# Clock Gater

|         |                                                                                  |
| ------- | -------------------------------------------------------------------------------- |
| Module  | Clock Gater                                                                      |
| Project | [OmniCores-BuildingBlocks](https://github.com/Louis-DR/OmniCores-BuildingBlocks) |
| Author  | Louis Duret-Robert - [louisduret@gmail.com](mailto:louisduret@gmail.com)         |
| Website | [louis-dr.github.io](https://louis-dr.github.io)                                 |
| License | MIT License - [mit-license.org](https://mit-license.org)                         |

## Overview

![clock_gater](clock_gater.symbol.svg)

Gates the input clock `clock_in` based on an `enable` signal using a latch-based clock gating architecture. It includes a `test_enable` signal which also allows the clock to pass through, typically used for scan testing or bypassing functional gating.

**Important:** This module provides a behavioral model of clock gating. For synthesis, it should be replaced by technology-specific integrated clock gating (ICG) cells provided by the ASIC/FPGA vendor libraries to ensure correct timing behavior and avoid glitches.

## Parameters

This module has no parameters.

## Ports

| Name          | Direction | Width | Clock      | Reset | Reset value | Description                                                                                              |
| ------------- | --------- | ----- | ---------- | ----- | ----------- | -------------------------------------------------------------------------------------------------------- |
| `clock_in`    | input     | 1     | self       |       |             | Input clock signal to be gated.                                                                          |
| `enable`      | input     | 1     | `clock_in` |       |             | Functional enable signal. Clock passes when high.                                                        |
| `test_enable` | input     | 1     | `clock_in` |       |             | Test enable signal. Clock passes when high,                                                              |
| `clock_out`   | output    | 1     | derived    |       |             | Gated clock output. Matches `clock_in` when `enable` or `test_enable` is high and stable, low otherwise. |

## Operation

The effective enable signal (`enable` OR `test_enable`) is latched on the falling edge of `clock_in`. The output clock `clock_out` is generated by ANDing the input clock `clock_in` with the latched enable value. This prevents glitches on `clock_out` when the enable signals change while `clock_in` is high.

## Paths

| From                    | To          | Type                 | Comment                                             |
| ----------------------- | ----------- | -------------------- | --------------------------------------------------- |
| `clock_in`              | `clock_out` | combinational        | Single AND gate with the effective enable signal.   |
| `enable`, `test_enable` | `clock_out` | sequential (latched) | Enable signals are captured into an internal latch. |

## Complexity

The behavioral model uses one latch (or flip-flop) and one AND gate.

## Verification

The clock gater is verified using a SystemVerilog testbench with four check sequences. It uses a helper macro to measure the frequency of the output clock.

| Number | Check                                     | Description                                                                                                           |
| ------ | ----------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| 1      | Normal disbale-enable-disable sequence    | Stimulate the normal enable signal and check that the clock is gated when the enable is high.                         |
| 2      | Test mode disbale-enable-disable sequence | Stimulate the test mode enable signal and check that the clock is gated when the enable is high.                      |
| 3      | Clock frequency division with enable      | Toggle the enable signal at each clock cycle and check that the output frequency is divided by two.                   |
| 4      | Glitch-free output clock                  | Toggle the enable signal at random time during the clock cycle and check that the output clock pulses are glitchless. |

## Constraints

As this is a behavioral model, the primary constraint is that it should not be synthesized directly. Use vendor-specific ICG cells instead.

## Deliverables

| Type              | File                                                       | Description                                         |
| ----------------- | ---------------------------------------------------------- | --------------------------------------------------- |
| Design            | [`clock_gater.v`](clock_gater.v)                           | Verilog design (behavioral model).                  |
| Testbench         | [`clock_gater.testbench.sv`](clock_gater.testbench.sv)     | SystemVerilog verification testbench.               |
| Waveform script   | [`clock_gater.testbench.gtkw`](clock_gater.testbench.gtkw) | Script to load the waveforms in GTKWave.            |
| Symbol descriptor | [`clock_gater.symbol.sss`](clock_gater.symbol.sss)         | Symbol descriptor for SiliconSuite-SymbolGenerator. |
| Symbol image      | [`clock_gater.symbol.svg`](clock_gater.symbol.svg)         | Generated vector image of the symbol.               |
| Symbol shape      | [`clock_gater.symbol.drawio`](clock_gater.symbol.drawio)   | Generated DrawIO shape of the symbol.               |
| Datasheet         | [`clock_gater.md`](clock_gater.md)                         | Markdown documentation datasheet.                   |

## Dependencies

This module has no dependency.

## Related modules

| Module                                                                                   | Path                                                               | Comment                                                   |
| ---------------------------------------------------------------------------------------- | ------------------------------------------------------------------ | --------------------------------------------------------- |
| [`static_clock_divider`](../static_clock_divider/static_clock_divider.md)                | `omnicores-buildingblocks/sources/clock/static_clock_divider`      | Static clock divider.                                     |
| [`clock_multiplexer`](../clock_multiplexer/clock_multiplexer.md)                         | `omnicores-buildingblocks/sources/clock/clock_multiplexer`         | Multiplexer to select between clocks.                     |
| [`fast_clock_multiplexer`](../fast_clock_multiplexer/fast_clock_multiplexer.md)          | `omnicores-buildingblocks/sources/clock/fast_clock_multiplexer`    | Faster clock multiplexer.                                 |
| [`nonstop_clock_multiplexer`](../nonstop_clock_multiplexer/nonstop_clock_multiplexer.md) | `omnicores-buildingblocks/sources/clock/nonstop_clock_multiplexer` | Clock multiplexer working when one clock is not running.  |
| [`switchover_clock_selector`](../switchover_clock_selector/switchover_clock_selector.md) | `omnicores-buildingblocks/sources/clock/switchover_clock_selector` | Selector that switches to a second clock onces it starts. |
| [`priority_clock_selector`](../priority_clock_selector/priority_clock_selector.md)       | `omnicores-buildingblocks/sources/clock/priority_clock_selector`   | Selector that switches to a priority clock automatically. |
